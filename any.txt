
// 1
//https://www.db-fiddle.com/f/uHX1YqBiMbkVAqwAfTo7V4/3

// 2
// file_put_contents("./counter.txt", file_get_contents("./counter.txt") + 1);
/*
- Одна из основных проблем несогласованный доступ к файлу, похорошему файл нужно блокировать
- как вариант кода
*/
$fp = fopen("./counter.txt", "a+");

for ($i = 0; $i < 10; $i ++) {
    if (flock($fp, LOCK_EX)) {
        rewind($fp);
        $size = intval(fgets($fp));
        ftruncate($fp, 0);
        fwrite($fp, $size + 1);
        fflush($fp);
        flock($fp, LOCK_UN);
        break;
    }
    sleep(1);
}

fclose($fp);

/*
- Решением проблемы с нагрузкой может быть просто последовательное дописывание в конец файла новой строки
- по достижению определенного размера файла, он будет агрегироватся т.е. сумма строк будет записана в начало файла, остальные строки удалены.
- В плане альтернативного подхода можно использовать у примеру MYSQL куда записывать в одну таблицу и агрегировать. Так же можно агрегировать по некоторому признаку, к примеру ИП или ИД сессии
- Такой подход обсеспечит сложность поиска по ИД O(log N) (если у ИД поставить индекс), что обеспечит небольшой рост времени, от роста данных. Так же движок БД возмет на себя реализацию алгоритма консистентности данных.
К примеру
INSERT INTO counter (id,cnt) VALUES ('PHP session id',1)
  ON DUPLICATE KEY UPDATE cnt=cnt+1;
*/

//3 см код

//4 см math.php


// 5
// https://www.db-fiddle.com/f/hsGsAKUatkGaW1uqw3aN7L/2